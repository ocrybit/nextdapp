{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar _this = this,\n    _jsxFileName = \"/home/basque/hide/next-dapp/nd/core/bind.js\";\n\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { global, conf, funcs, atoms } from \"nd\";\nimport { selector, useRecoilValue, atom } from \"recoil\";\nimport { keys, compose, mergeLeft, has, assocPath, isNil, mapObjIndexed, map, is, pick, complement, forEach, both, cond } from \"ramda\";\nimport { withRouter } from \"next/router\";\nimport setter from \"./setter\";\nimport func from \"./func\";\nvar isNonArrayObj = both(is(Object), complement(is(Array)));\nexport default (function (Component) {\n  var _arr = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  var track = arguments.length > 2 ? arguments[2] : undefined;\n  var arr = is(Array)(_arr) ? _arr : is(Array)(Component.props) ? [] : [];\n  return withRouter(function (props) {\n    var _s = $RefreshSig$();\n\n    var _props = [];\n    var _funcs = [];\n    var _tracks = {};\n\n    var initAtom = function initAtom(v, init) {\n      if (has(v)(atoms)) {\n        _props.push(v);\n      } else if (has(v)(funcs)) {\n        _funcs.push(v);\n      } else {\n        _props.push(v);\n\n        atoms[v] = atom({\n          key: v,\n          \"default\": init\n        });\n        console.log(\"new atom created...\".concat(v));\n      }\n    };\n\n    forEach(function (v) {\n      if (isNonArrayObj(v)) {\n        var selectors = {};\n        mapObjIndexed(function (v2, key) {\n          if (is(Function)(v2)) {\n            var fn = func(v2);\n            funcs[key] = fn;\n\n            _funcs.push(key);\n          } else if (is(Array)(v2) && is(Function)(v2[0])) {\n            var _fn = func(v2[1], v2[0]);\n\n            funcs[key] = _fn;\n\n            _funcs.push(key);\n          } else if (is(Function)(v2.get)) {\n            var sel;\n\n            if (!has(key)(atoms)) {\n              sel = selector({\n                key: key,\n                get: v2.get(atoms)\n              });\n              atoms[key] = sel;\n            } else {\n              sel = atoms[key];\n            }\n\n            selectors[key] = sel;\n          } else {\n            initAtom(key, v2);\n          }\n        })(v);\n        _tracks = mergeLeft(selectors, _tracks);\n      } else if (is(String)(v)) {\n        initAtom(v, null);\n      } else {\n        console.log(\"unknow binding type\");\n        console.log(v);\n      }\n    })(arr);\n\n    var _setter = setter(_props),\n        set = _setter.set,\n        get = _setter.get,\n        binder = _setter.binder;\n\n    var tracker = null;\n\n    if (is(String)(track)) {\n      var track_name = \"\".concat(track, \"$tracker\");\n      var diff_name = \"\".concat(track_name, \"_diff\");\n      var prev_name = \"\".concat(track_name, \"_prev\");\n\n      if (!has(diff_name)(atoms)) {\n        atoms[diff_name] = atom({\n          key: diff_name,\n          \"default\": []\n        });\n        atoms[prev_name] = atom({\n          key: prev_name,\n          \"default\": {}\n        });\n      }\n\n      tracker = {\n        diff: atoms[diff_name],\n        prev: atoms[prev_name]\n      };\n    }\n\n    var $ = map(function (v) {\n      return v.get;\n    })(binder);\n    return __jsx(Component, _extends({\n      tracker: tracker,\n      init: function init(_arr) {\n        forEach(function (v) {\n          if (isNonArrayObj(v)) {\n            var selectors = {};\n            mapObjIndexed(function (v2, key) {\n              if (is(Function)(v2)) {\n                var fn = func(v2);\n                funcs[key] = fn;\n\n                _funcs.push(key);\n              } else if (is(Array)(v2) && is(Function)(v2[0])) {\n                var _fn2 = func(v2[1], v2[0]);\n\n                funcs[key] = _fn2;\n\n                _funcs.push(key);\n              } else {\n                console.log(\"not a function\");\n              }\n            })(v);\n          } else if (is(String)(v)) {\n            if (has(v)(atoms)) {\n              console.log(\"this is atom\");\n            } else if (has(v)(funcs)) {\n              _funcs.push(v);\n            } else {\n              console.log(\"\".concat(v, \" doesn't exist\"));\n            }\n          } else {\n            console.log(\"unknow binding type\");\n            console.log(v);\n          }\n        })(_arr || []);\n        return mapObjIndexed(function (v, k) {\n          return v();\n        })(pick(_funcs)(funcs));\n      },\n      $: $,\n      conf: conf,\n      global: global,\n      set: set,\n      get: get\n    }, mapObjIndexed(_s(function (v, k) {\n      _s();\n\n      return useRecoilValue(v);\n    }, \"wPt1njVJmiJoDKV0uRkjcvp7eFI=\", false, function () {\n      return [useRecoilValue];\n    }))(_tracks), $, props, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }));\n  });\n});","map":{"version":3,"sources":["/home/basque/hide/next-dapp/nd/core/bind.js"],"names":["React","global","conf","funcs","atoms","selector","useRecoilValue","atom","keys","compose","mergeLeft","has","assocPath","isNil","mapObjIndexed","map","is","pick","complement","forEach","both","cond","withRouter","setter","func","isNonArrayObj","Object","Array","Component","_arr","track","arr","props","_props","_funcs","_tracks","initAtom","v","init","push","key","console","log","selectors","v2","Function","fn","get","sel","String","set","binder","tracker","track_name","diff_name","prev_name","diff","prev","$","k"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport { global, conf, funcs, atoms } from \"nd\"\n\nimport { selector, useRecoilValue, atom } from \"recoil\"\n\nimport {\n  keys,\n  compose,\n  mergeLeft,\n  has,\n  assocPath,\n  isNil,\n  mapObjIndexed,\n  map,\n  is,\n  pick,\n  complement,\n  forEach,\n  both,\n  cond\n} from \"ramda\"\n\nimport { withRouter } from \"next/router\"\nimport setter from \"./setter\"\nimport func from \"./func\"\n\nconst isNonArrayObj = both(is(Object), complement(is(Array)))\n\nexport default (Component, _arr = [], track) => {\n  const arr = is(Array)(_arr) ? _arr : is(Array)(Component.props) ? [] : []\n  return withRouter(props => {\n    let _props = []\n    let _funcs = []\n    let _tracks = {}\n    const initAtom = (v, init) => {\n      if (has(v)(atoms)) {\n        _props.push(v)\n      } else if (has(v)(funcs)) {\n        _funcs.push(v)\n      } else {\n        _props.push(v)\n        atoms[v] = atom({\n          key: v,\n          default: init\n        })\n        console.log(`new atom created...${v}`)\n      }\n    }\n    forEach(v => {\n      if (isNonArrayObj(v)) {\n        const selectors = {}\n        mapObjIndexed((v2, key) => {\n          if (is(Function)(v2)) {\n            const fn = func(v2)\n            funcs[key] = fn\n            _funcs.push(key)\n          } else if (is(Array)(v2) && is(Function)(v2[0])) {\n            const fn = func(v2[1], v2[0])\n            funcs[key] = fn\n            _funcs.push(key)\n          } else if (is(Function)(v2.get)) {\n            let sel\n            if (!has(key)(atoms)) {\n              sel = selector({\n                key: key,\n                get: v2.get(atoms)\n              })\n              atoms[key] = sel\n            } else {\n              sel = atoms[key]\n            }\n            selectors[key] = sel\n          } else {\n            initAtom(key, v2)\n          }\n        })(v)\n        _tracks = mergeLeft(selectors, _tracks)\n      } else if (is(String)(v)) {\n        initAtom(v, null)\n      } else {\n        console.log(`unknow binding type`)\n        console.log(v)\n      }\n    })(arr)\n    const { set, get, binder } = setter(_props)\n    let tracker = null\n    if (is(String)(track)) {\n      const track_name = `${track}$tracker`\n      const diff_name = `${track_name}_diff`\n      const prev_name = `${track_name}_prev`\n      if (!has(diff_name)(atoms)) {\n        atoms[diff_name] = atom({ key: diff_name, default: [] })\n        atoms[prev_name] = atom({ key: prev_name, default: {} })\n      }\n      tracker = { diff: atoms[diff_name], prev: atoms[prev_name] }\n    }\n    const $ = map(v => v.get)(binder)\n    return (\n      <Component\n        tracker={tracker}\n        init={_arr => {\n          forEach(v => {\n            if (isNonArrayObj(v)) {\n              const selectors = {}\n              mapObjIndexed((v2, key) => {\n                if (is(Function)(v2)) {\n                  const fn = func(v2)\n                  funcs[key] = fn\n                  _funcs.push(key)\n                } else if (is(Array)(v2) && is(Function)(v2[0])) {\n                  const fn = func(v2[1], v2[0])\n                  funcs[key] = fn\n                  _funcs.push(key)\n                } else {\n                  console.log(`not a function`)\n                }\n              })(v)\n            } else if (is(String)(v)) {\n              if (has(v)(atoms)) {\n                console.log(`this is atom`)\n              } else if (has(v)(funcs)) {\n                _funcs.push(v)\n              } else {\n                console.log(`${v} doesn't exist`)\n              }\n            } else {\n              console.log(`unknow binding type`)\n              console.log(v)\n            }\n          })(_arr || [])\n          return mapObjIndexed((v, k) => v())(pick(_funcs)(funcs))\n        }}\n        $={$}\n        conf={conf}\n        global={global}\n        set={set}\n        get={get}\n        {...mapObjIndexed((v, k) => useRecoilValue(v))(_tracks)}\n        {...$}\n        {...props}\n      />\n    )\n  })\n}\n"]},"metadata":{},"sourceType":"module"}