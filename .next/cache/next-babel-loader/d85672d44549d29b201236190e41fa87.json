{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { o, mergeRight, mergeLeft, pick, hasPath, is, complement, isNil, concat, compose, map, reduce, zip, pluck, mergeDeepLeft } from \"ramda\";\nimport { xNil } from \"nd/util\";\nimport Web3 from \"web3\";\n\nvar abi_erc20 = require(\"./IERC20.json\");\n\nexport var ETHEREUM_NETWORKS = {\n  \"1\": \"mainnet\",\n  \"3\": \"ropsten\",\n  \"4\": \"rinkby\",\n  \"42\": \"kovan\"\n};\nexport var isAddress = function isAddress(address) {\n  return window.web3.utils.isAddress(address);\n};\nexport var toWei = function toWei(amount) {\n  return window.web3.utils.toWei(amount);\n};\nexport var fromWei = function fromWei(amount) {\n  return window.web3.utils.fromWei(amount);\n};\n\nvar setETH = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var _ref$val, network, new_address, set, conf, global, get, web3_address, current_network, balance, obj;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _ref$val = _ref.val, network = _ref$val.network, new_address = _ref$val.new_address, set = _ref.set, conf = _ref.conf, global = _ref.global, get = _ref.get;\n            web3_address = null;\n            current_network = null;\n            balance = null;\n\n            if (!complement(isNil)(window.web3.currentProvider)) {\n              _context.next = 11;\n              break;\n            }\n\n            current_network = window.web3.currentProvider.networkVersion || window.web3.currentProvider._network;\n\n            if (!(current_network === (network || conf.web3.network))) {\n              _context.next = 11;\n              break;\n            }\n\n            web3_address = new_address || window.web3.currentProvider.selectedAddress || window.web3.currentProvider._selectedAddress;\n            _context.next = 10;\n            return window.web3.eth.getBalance(web3_address);\n\n          case 10:\n            balance = _context.sent;\n\n          case 11:\n            obj = {\n              web3_network: current_network,\n              web3_address: web3_address,\n              eth_balance: {\n                network: current_network,\n                str: window.web3.utils.fromWei(balance || \"0\"),\n                wei: balance,\n                address: web3_address\n              }\n            };\n\n            if (complement(isNil)(web3_address) && isNil(get(\"address_in_use\"))) {\n              obj.address_in_use = \"eth\";\n            } else if (isNil(web3_address)) {\n              obj.address_in_use = isNil(get(\"auth_selected\")) ? null : \"auth\";\n            }\n\n            global.web3_address = web3_address;\n            obj.web3_updated = Date.now();\n            set(obj, null);\n            set(true, \"web3_init\");\n            return _context.abrupt(\"return\", obj);\n\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function setETH(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport var initWeb3 = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3) {\n    var _ref3$val, network, balances, conf, fn, set;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _ref3$val = _ref3.val, network = _ref3$val.network, balances = _ref3$val.balances, conf = _ref3.conf, fn = _ref3.fn, set = _ref3.set;\n\n            if (!window.ethereum) {\n              _context2.next = 13;\n              break;\n            }\n\n            window.web3 = new Web3(window.ethereum);\n            _context2.prev = 3;\n            _context2.next = 6;\n            return window.ethereum.enable();\n\n          case 6:\n            _context2.next = 11;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](3);\n            console.log(\"access denied\");\n\n          case 11:\n            _context2.next = 14;\n            break;\n\n          case 13:\n            if (window.web3) {\n              window.web3 = new Web3(window.web3.currentProvider);\n            } else {\n              console.log(\"Non-Ethereum browser detected. You should consider trying MetaMask!\");\n            }\n\n          case 14:\n            if (complement(isNil)(window.web3)) {\n              fn(setETH)({\n                network: network\n              });\n\n              if (!isNil(window.web3.currentProvider.publicConfigStore)) {\n                window.web3.currentProvider.publicConfigStore.on(\"update\", function (c) {\n                  fn(setETH)({\n                    network: network\n                  });\n                });\n              } else if (!isNil(window.ethereum)) {\n                window.ethereum.on(\"chainChanged\", function (c) {\n                  return window.location.reload();\n                });\n                window.ethereum.on(\"message\", function (c) {\n                  return fn(setETH)({\n                    network: network\n                  });\n                });\n                window.ethereum.on(\"accountsChanged\", function (accounts) {\n                  return fn(setETH)({\n                    network: network,\n                    new_address: accounts[0]\n                  });\n                });\n              }\n            } else {\n              set(true, \"web3_init\");\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[3, 8]]);\n  }));\n\n  return function initWeb3(_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nvar listenTransaction = /*#__PURE__*/function () {\n  var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref5) {\n    var method, args, eth, from, to, value, hashFunc, obj, _sender, sender, receipt, err, hash;\n\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            method = _ref5.method, args = _ref5.args, eth = _ref5.eth, from = _ref5.from, to = _ref5.to, value = _ref5.value;\n            hashFunc = is(Function)(args[args.length - 1]) ? args.pop() : null;\n            obj = is(Object)(args[args.length - 1]) ? args.pop() : {};\n            hashFunc = is(Function)(obj.transactionHash) ? obj.transactionHash : hashFunc;\n            _sender = {\n              from: from\n            };\n            if (xNil(to)) _sender.to = to;\n            if (xNil(value)) _sender.value = value;\n            sender = o(mergeRight(_sender), pick([\"from\", \"to\", \"value\", \"gas\", \"gasPrice\", \"data\", \"nonce\"]))(obj);\n            receipt = null;\n            err = null;\n            hash = null;\n            _context6.prev = 11;\n            _context6.next = 14;\n            return (eth ? method(sender) : method.apply(void 0, _toConsumableArray(args)).send(sender)).on(\"transactionHash\", /*#__PURE__*/function () {\n              var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(hash) {\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        hash = hash;\n                        if (is(Function)(hashFunc)) hashFunc(hash);\n\n                      case 2:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function (_x4) {\n                return _ref7.apply(this, arguments);\n              };\n            }()).on(\"confirmation\", /*#__PURE__*/function () {\n              var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(number, receipt) {\n                return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        if (is(Function)(obj.confirmation)) obj.confirmation(number, receipt);\n\n                      case 1:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              }));\n\n              return function (_x5, _x6) {\n                return _ref8.apply(this, arguments);\n              };\n            }()).on(\"error\", /*#__PURE__*/function () {\n              var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(error) {\n                return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        if (is(Function)(obj.error)) obj.error(error);\n\n                      case 1:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5);\n              }));\n\n              return function (_x7) {\n                return _ref9.apply(this, arguments);\n              };\n            }());\n\n          case 14:\n            receipt = _context6.sent;\n            _context6.next = 20;\n            break;\n\n          case 17:\n            _context6.prev = 17;\n            _context6.t0 = _context6[\"catch\"](11);\n            err = _context6.t0;\n\n          case 20:\n            return _context6.abrupt(\"return\", [err, receipt]);\n\n          case 21:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6, null, [[11, 17]]);\n  }));\n\n  return function listenTransaction(_x3) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nexport var contract = function contract(_ref10) {\n  var _ref10$val = _ref10.val,\n      abi = _ref10$val.abi,\n      address = _ref10$val.address,\n      get = _ref10.get;\n  var contract = new window.web3.eth.Contract(abi, address);\n  var methods = {};\n\n  var _iterator = _createForOfIteratorHelper(abi),\n      _step;\n\n  try {\n    var _loop = function _loop() {\n      var v = _step.value;\n\n      if (v.type === \"function\" && v.constant) {\n        methods[v.name] = function () {\n          var _contract$methods;\n\n          return (_contract$methods = contract.methods)[v.name].apply(_contract$methods, arguments).call();\n        };\n      } else if (v.type === \"function\" && v.constant !== true) {\n        methods[v.name] = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n          var _len,\n              args,\n              _key,\n              _args7 = arguments;\n\n          return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  for (_len = _args7.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n                    args[_key] = _args7[_key];\n                  }\n\n                  _context7.next = 3;\n                  return listenTransaction({\n                    method: contract.methods[v.name],\n                    args: args,\n                    from: get(\"web3_address\")\n                  });\n\n                case 3:\n                  return _context7.abrupt(\"return\", _context7.sent);\n\n                case 4:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee7);\n        }));\n      }\n    };\n\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      _loop();\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return methods;\n};\nexport var erc20 = function erc20(_ref12) {\n  var _ref12$val = _ref12.val,\n      token = _ref12$val.token,\n      address = _ref12$val.address,\n      conf = _ref12.conf,\n      fn = _ref12.fn;\n  var contract_address = xNil(token) && hasPath([\"web3\", \"erc20\", token])(conf) ? conf.web3.erc20[token] : address;\n  return fn(contract)({\n    abi: abi_erc20,\n    address: contract_address\n  });\n};\nexport var eth = function eth(_ref13) {\n  var fn = _ref13.fn,\n      get = _ref13.get;\n  var web3js = {\n    balanceOf: function balanceOf(address) {\n      return window.web3.eth.getBalance(address || get(\"web3_address\"));\n    },\n    getBalance: function getBalance(address) {\n      return window.web3.eth.getBalance(address || get(\"web3_address\"));\n    }\n  };\n  web3js.transfer = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n    var _len2,\n        args,\n        _key2,\n        _args8 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            for (_len2 = _args8.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n              args[_key2] = _args8[_key2];\n            }\n\n            _context8.next = 3;\n            return listenTransaction({\n              eth: true,\n              to: args[0],\n              value: args[1],\n              method: window.web3.eth.sendTransaction,\n              args: args.slice(2),\n              from: get(\"web3_address\")\n            });\n\n          case 3:\n            return _context8.abrupt(\"return\", _context8.sent);\n\n          case 4:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8);\n  }));\n  web3js.sendTransaction = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n    var _len3,\n        args,\n        _key3,\n        _args9 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            for (_len3 = _args9.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n              args[_key3] = _args9[_key3];\n            }\n\n            _context9.next = 3;\n            return listenTransaction({\n              eth: true,\n              method: window.web3.eth.sendTransaction,\n              args: args,\n              from: get(\"web3_address\")\n            });\n\n          case 3:\n            return _context9.abrupt(\"return\", _context9.sent);\n\n          case 4:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9);\n  }));\n  return web3js;\n};","map":{"version":3,"sources":["/home/basque/hide/next-dapp/nd/web3/web3.js"],"names":["o","mergeRight","mergeLeft","pick","hasPath","is","complement","isNil","concat","compose","map","reduce","zip","pluck","mergeDeepLeft","xNil","Web3","abi_erc20","require","ETHEREUM_NETWORKS","isAddress","address","window","web3","utils","toWei","amount","fromWei","setETH","val","network","new_address","set","conf","global","get","web3_address","current_network","balance","currentProvider","networkVersion","_network","selectedAddress","_selectedAddress","eth","getBalance","obj","web3_network","eth_balance","str","wei","address_in_use","web3_updated","Date","now","initWeb3","balances","fn","ethereum","enable","console","log","publicConfigStore","on","c","location","reload","accounts","listenTransaction","method","args","from","to","value","hashFunc","Function","length","pop","Object","transactionHash","_sender","sender","receipt","err","hash","send","number","confirmation","error","contract","abi","Contract","methods","v","type","constant","name","call","erc20","token","contract_address","web3js","balanceOf","transfer","sendTransaction","slice"],"mappings":"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","sourcesContent":["import {\n  o,\n  mergeRight,\n  mergeLeft,\n  pick,\n  hasPath,\n  is,\n  complement,\n  isNil,\n  concat,\n  compose,\n  map,\n  reduce,\n  zip,\n  pluck,\n  mergeDeepLeft\n} from \"ramda\"\n\nimport { xNil } from \"nd/util\"\n\nimport Web3 from \"web3\"\n\nconst abi_erc20 = require(\"./IERC20.json\")\n\nexport const ETHEREUM_NETWORKS = {\n  \"1\": \"mainnet\",\n  \"3\": \"ropsten\",\n  \"4\": \"rinkby\",\n  \"42\": \"kovan\"\n}\n\nexport const isAddress = address => window.web3.utils.isAddress(address)\n\nexport const toWei = amount => window.web3.utils.toWei(amount)\n\nexport const fromWei = amount => window.web3.utils.fromWei(amount)\n\nconst setETH = async ({\n  val: { network, new_address },\n  set,\n  conf,\n  global,\n  get\n}) => {\n  let web3_address = null\n  let current_network = null\n  let balance = null\n  if (complement(isNil)(window.web3.currentProvider)) {\n    current_network =\n      window.web3.currentProvider.networkVersion ||\n      window.web3.currentProvider._network\n    if (current_network === (network || conf.web3.network)) {\n      web3_address =\n        new_address ||\n        window.web3.currentProvider.selectedAddress ||\n        window.web3.currentProvider._selectedAddress\n      balance = await window.web3.eth.getBalance(web3_address)\n    }\n  }\n  let obj = {\n    web3_network: current_network,\n    web3_address: web3_address,\n    eth_balance: {\n      network: current_network,\n      str: window.web3.utils.fromWei(balance || \"0\"),\n      wei: balance,\n      address: web3_address\n    }\n  }\n\n  if (complement(isNil)(web3_address) && isNil(get(\"address_in_use\"))) {\n    obj.address_in_use = \"eth\"\n  } else if (isNil(web3_address)) {\n    obj.address_in_use = isNil(get(\"auth_selected\")) ? null : \"auth\"\n  }\n\n  global.web3_address = web3_address\n  obj.web3_updated = Date.now()\n  set(obj, null)\n  set(true, \"web3_init\")\n  return obj\n}\n\nexport const initWeb3 = async ({\n  val: { network, balances },\n  conf,\n  fn,\n  set\n}) => {\n  if (window.ethereum) {\n    window.web3 = new Web3(window.ethereum)\n    try {\n      await window.ethereum.enable()\n    } catch (error) {\n      console.log(\"access denied\")\n    }\n  } else if (window.web3) {\n    window.web3 = new Web3(window.web3.currentProvider)\n  } else {\n    console.log(\n      \"Non-Ethereum browser detected. You should consider trying MetaMask!\"\n    )\n  }\n  if (complement(isNil)(window.web3)) {\n    fn(setETH)({ network })\n    if (!isNil(window.web3.currentProvider.publicConfigStore)) {\n      window.web3.currentProvider.publicConfigStore.on(\"update\", c => {\n        fn(setETH)({ network })\n      })\n    } else if (!isNil(window.ethereum)) {\n      window.ethereum.on(\"chainChanged\", c => window.location.reload())\n      window.ethereum.on(\"message\", c => fn(setETH)({ network }))\n      window.ethereum.on(\"accountsChanged\", accounts =>\n        fn(setETH)({ network, new_address: accounts[0] })\n      )\n    }\n  } else {\n    set(true, \"web3_init\")\n  }\n  return\n}\n\nconst listenTransaction = async ({ method, args, eth, from, to, value }) => {\n  let hashFunc = is(Function)(args[args.length - 1]) ? args.pop() : null\n  const obj = is(Object)(args[args.length - 1]) ? args.pop() : {}\n  hashFunc = is(Function)(obj.transactionHash) ? obj.transactionHash : hashFunc\n  let _sender = { from }\n  if (xNil(to)) _sender.to = to\n  if (xNil(value)) _sender.value = value\n  const sender = o(\n    mergeRight(_sender),\n    pick([\"from\", \"to\", \"value\", \"gas\", \"gasPrice\", \"data\", \"nonce\"])\n  )(obj)\n\n  let receipt = null\n  let err = null\n  let hash = null\n  try {\n    receipt = await (eth ? method(sender) : method(...args).send(sender))\n      .on(\"transactionHash\", async hash => {\n        hash = hash\n        if (is(Function)(hashFunc)) hashFunc(hash)\n      })\n      .on(\"confirmation\", async (number, receipt) => {\n        if (is(Function)(obj.confirmation)) obj.confirmation(number, receipt)\n      })\n      .on(\"error\", async error => {\n        if (is(Function)(obj.error)) obj.error(error)\n      })\n  } catch (e) {\n    err = e\n  }\n  return [err, receipt]\n}\n\nexport const contract = ({ val: { abi, address }, get }) => {\n  const contract = new window.web3.eth.Contract(abi, address)\n  let methods = {}\n  for (let v of abi) {\n    if (v.type === \"function\" && v.constant) {\n      methods[v.name] = (...args) => contract.methods[v.name](...args).call()\n    } else if (v.type === \"function\" && v.constant !== true) {\n      methods[v.name] = async (...args) => {\n        return await listenTransaction({\n          method: contract.methods[v.name],\n          args,\n          from: get(\"web3_address\")\n        })\n      }\n    }\n  }\n  return methods\n}\n\nexport const erc20 = ({ val: { token, address }, conf, fn }) => {\n  const contract_address =\n    xNil(token) && hasPath([\"web3\", \"erc20\", token])(conf)\n      ? conf.web3.erc20[token]\n      : address\n  return fn(contract)({ abi: abi_erc20, address: contract_address })\n}\n\nexport const eth = ({ fn, get }) => {\n  let web3js = {\n    balanceOf: address =>\n      window.web3.eth.getBalance(address || get(\"web3_address\")),\n    getBalance: address =>\n      window.web3.eth.getBalance(address || get(\"web3_address\"))\n  }\n  web3js.transfer = async (...args) => {\n    return await listenTransaction({\n      eth: true,\n      to: args[0],\n      value: args[1],\n      method: window.web3.eth.sendTransaction,\n      args: args.slice(2),\n      from: get(\"web3_address\")\n    })\n  }\n  web3js.sendTransaction = async (...args) => {\n    return await listenTransaction({\n      eth: true,\n      method: window.web3.eth.sendTransaction,\n      args,\n      from: get(\"web3_address\")\n    })\n  }\n\n  return web3js\n}\n"]},"metadata":{},"sourceType":"module"}